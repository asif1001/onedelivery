<!DOCTYPE html>
<html>
<head>
    <title>Firebase Connection Test</title>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBYlgPrP-2kL6bRZShHUH2ht_bODXG3kOY",
            authDomain: "oil-delivery-6bcc4.firebaseapp.com",
            projectId: "oil-delivery-6bcc4",
            storageBucket: "oil-delivery-6bcc4.firebasestorage.app",
            messagingSenderId: "136339484143",
            appId: "1:136339484143:web:06d51d52f3a0b38e46be96",
            measurementId: "G-KM58SN9WYL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function testConnection() {
            const output = document.getElementById('output');
            
            try {
                output.innerHTML += '<p>✅ Firebase initialized successfully</p>';
                
                // Test 1: Try to write a test document
                output.innerHTML += '<p>🔧 Testing write access...</p>';
                await setDoc(doc(db, 'test', 'connection'), {
                    message: 'Connection test successful',
                    timestamp: new Date(),
                    from: 'onedelveiry-app'
                });
                output.innerHTML += '<p>✅ Write test successful</p>';
                
                // Test 2: Try to read the test document
                output.innerHTML += '<p>🔧 Testing read access...</p>';
                const docSnap = await getDoc(doc(db, 'test', 'connection'));
                if (docSnap.exists()) {
                    output.innerHTML += '<p>✅ Read test successful</p>';
                    output.innerHTML += '<p>📄 Document data: ' + JSON.stringify(docSnap.data()) + '</p>';
                } else {
                    output.innerHTML += '<p>❌ Document not found</p>';
                }
                
                // Test 3: Try to read a collection
                output.innerHTML += '<p>🔧 Testing collection access...</p>';
                const querySnapshot = await getDocs(collection(db, 'branches'));
                output.innerHTML += '<p>📊 Branches collection size: ' + querySnapshot.size + '</p>';
                
                if (querySnapshot.size > 0) {
                    output.innerHTML += '<p>✅ Found existing data in branches collection</p>';
                    querySnapshot.forEach((doc) => {
                        output.innerHTML += '<p>📄 Branch: ' + JSON.stringify(doc.data()) + '</p>';
                    });
                } else {
                    output.innerHTML += '<p>⚠️ No data found in branches collection</p>';
                }
                
                output.innerHTML += '<p><strong>🎉 Database connection is working!</strong></p>';
                
            } catch (error) {
                output.innerHTML += '<p>❌ Error: ' + error.code + ' - ' + error.message + '</p>';
                console.error('Firebase test error:', error);
            }
        }

        // Run test when page loads
        window.addEventListener('load', testConnection);
    </script>
</head>
<body>
    <h1>onedelveiry Firebase Connection Test</h1>
    <div id="output">
        <p>🔄 Testing Firebase connection...</p>
    </div>
</body>
</html>